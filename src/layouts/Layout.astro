---
import Orb from "../components/Orb.jsx";
import CookieBanner from "../components/CookieBanner.astro";

interface Props {
    title: string;
}
const { title } = Astro.props;

// TU ID DE ANALYTICS
const GA_ID = "G-4FLC2T40F9";
---

<!doctype html>
<html lang="es">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <meta name="theme-color" content="#050505" />
        <meta
            name="description"
            content="Byit: Desarrollo web de alto rendimiento."
        />

        <link
            rel="icon"
            type="image/png"
            sizes="32x32"
            href="/img/favicon.png"
        />
        <link
            rel="icon"
            type="image/png"
            sizes="16x16"
            href="/img/favicon.png"
        />
        <link rel="apple-touch-icon" sizes="180x180" href="/img/favicon.png" />
        <meta property="og:title" content={title} />
        <meta property="og:type" content="website" />
        <meta property="og:image" content="/img/og-image.png" />
        <title>{title}</title>

        <!-- DNS Preconnect para recursos externos -->
        <link rel="preconnect" href="https://fonts.googleapis.com" />
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
        <link rel="preconnect" href="https://www.googletagmanager.com" />
        <link rel="dns-prefetch" href="https://cdn.jsdelivr.net" />

        <!-- Fuentes con display=swap para evitar FOIT -->
        <link
            href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap"
            rel="stylesheet"
        />
        <link
            href="https://fonts.googleapis.com/css2?family=Kanit:ital,wght@1,900&display=swap"
            rel="stylesheet"
        />

        <!-- Google Tag Manager con Partytown (corre en Web Worker) -->
        <script type="text/partytown">
            (function (w, d, s, l, i) {
                w[l] = w[l] || [];
                w[l].push({
                    "gtm.start": new Date().getTime(),
                    event: "gtm.js",
                });
                var f = d.getElementsByTagName(s)[0],
                    j = d.createElement(s),
                    dl = l != "dataLayer" ? "&l=" + l : "";
                j.async = true;
                j.src = "https://www.googletagmanager.com/gtm.js?id=" + i + dl;
                f.parentNode.insertBefore(j, f);
            })(window, document, "script", "dataLayer", "GTM-PNH455WH");
        </script>

        <!-- Google Analytics con Partytown -->
        <script type="text/partytown" define:vars={{ GA_ID }}>
            window.dataLayer = window.dataLayer || [];
            function gtag() {
                dataLayer.push(arguments);
            }
            gtag("consent", "default", {
                ad_storage: "denied",
                analytics_storage: "denied",
            });
            gtag("js", new Date());
            gtag("config", GA_ID);
        </script>
        <script
            type="text/partytown"
            async
            src={`https://www.googletagmanager.com/gtag/js?id=${GA_ID}`}
        ></script>
    </head>

    <body class="bg-[#050505] text-white font-sans antialiased relative">
        <noscript>
            <iframe
                src="https://www.googletagmanager.com/ns.html?id=GTM-PNH455WH"
                height="0"
                width="0"
                style="display:none;visibility:hidden"></iframe>
        </noscript>

        <!-- Fondo del Orb (gradientes animados) -->

        <div
            id="orb-container"
            class="fixed top-0 left-0 w-full h-[800px] -z-10 transition-opacity duration-500 ease-out opacity-90"
        >
            <Orb
                client:idle
                hue={0}
                hoverIntensity={0.6}
                rotateOnHover={true}
                backgroundColor="#000000"
            />
        </div>

        <slot />

        <CookieBanner />

        <script>
            // 1. Orb Opacity logic
            const orbContainer = document.getElementById("orb-container");
            window.addEventListener("scroll", () => {
                if (orbContainer)
                    orbContainer.style.opacity = Math.max(
                        0,
                        0.9 - window.scrollY / 600,
                    ).toString();
            });

            // 2. Smooth Scroll Nativo (sin librerías - máximo rendimiento)
            // Enlaces de ancla con scroll suave
            document.querySelectorAll('a[href^="#"]').forEach((anchor) => {
                anchor.addEventListener("click", function (e) {
                    e.preventDefault();
                    const href = this.getAttribute("href");
                    if (href && href !== "#") {
                        const target = document.querySelector(href);
                        if (target) {
                            target.scrollIntoView({
                                behavior: "smooth",
                                block: "start",
                            });
                        }
                    }
                });
            });

            // 3. Animaciones Scroll (DESACTIVADAS - causaban sticky scroll)
            // Las animaciones se activarán via CSS hover/visible states
            /*
            const observerOptions = {
                root: null,
                rootMargin: "0px",
                threshold: 0.1,
            };
            const observer = new IntersectionObserver((entries) => {
                entries.forEach((entry) => {
                    if (entry.isIntersecting) {
                        entry.target.classList.add("is-visible");
                        observer.unobserve(entry.target);
                    }
                });
            }, observerOptions);

            document
                .querySelectorAll(".animate-on-scroll, .title-glow")
                .forEach((el) => observer.observe(el));
            */
        </script>
    </body>
</html>

<style is:global>
    /* === ESTILOS GENERALES === */

    .font-fact {
        font-family: "Kanit", sans-serif;
        font-style: italic;
        font-weight: 900;
        text-transform: uppercase;
        letter-spacing: 0.02em;
    }

    ::-webkit-scrollbar {
        display: none;
    }
    html {
        scrollbar-width: none;
    }

    /* Animaciones desactivadas para evitar sticky scroll */
    .animate-on-scroll {
        opacity: 1;
        transform: translate(0, 0);
    }

    .title-glow {
        text-shadow:
            0 0 15px rgba(255, 255, 255, 0.45),
            0 0 30px rgba(255, 255, 255, 0.25);
    }
</style>
